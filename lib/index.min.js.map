{"version":3,"sources":["webpack://Mem/webpack/universalModuleDefinition","webpack://Mem/webpack/bootstrap","webpack://Mem/external \"lodash\"","webpack://Mem/./src/mem.coffee","webpack://Mem/./src/query.coffee","webpack://Mem/./src/index.coffee","webpack://Mem/./src/base.coffee","webpack://Mem/./src/rule.coffee","webpack://Mem/./src/set.coffee","webpack://Mem/./src/map.coffee","webpack://Mem/./src/list.coffee","webpack://Mem/./src/model.coffee","webpack://Mem/./src/finder.coffee"],"names":["root","factory","exports","module","define","amd","global","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","Finder","Map","Name","OBJ","Query","Set","State","cache","merge","set_depend","set_deploy","transaction","cb","result","$journal","journal","type","list","base1","$sort","$memory","$format","base","step","$base","store","pack","model","bless","item","clear_cache","deploys","push","depends","results","val","append","_","query_parser","set_for","len","set","length","req","this","_filters","concat","constructor","Function","Array","String","console","log","[object Object]","_all_ids","_group","$partition","all","tap","_step","_copy","_all_ids1","_group1","_filters1","$sort1","$partition1","$page_by","q","target","path","add","ref","f","ref1","RegExp","test","Boolean","Number","indexOf","Error","ary","text","regexp","split","replace","join","where","search_words","sort","Math","random","order","isEqual","cloneDeep","page_by","ids","oo","find","id","form","__proto__","hash","pluck","arguments","defineProperties","reduce","_finder","calculate","_reduce","memory","keys","undefined","Mem","Rule","Base","List","Model","rename","snakeCase","$name","map","build","depend_on","map_property","model_property","_id","form_property","changes","$model","isChanged","list_property","first","head","tail","last","uniq","at","set_property","schema","_set","finder","parent","use_cache","assign","scope","default_scope","shuffle","ik","else_id","cmd","qk","_ids","a","j","k","len1","args","name1","pk","belongs_to","deploy","idx","subids","slice","siblings","to","option","miss","relation_to_one","reverse","relation_to_many","fk","relation_tree","leaf","not_leaf","cost","directed","relation_graph","f_clear","f_item","f_merge","f_remove","f_reset","reset","remove","clear_cach","reject","del","refresh","rehash","splice","$group","$deploy","$deploy_reduce","$deploy_sort","emit_group","map_j","init","emit","map_partition","map_reduce","count","query","from","___","counts","len2","len3","per","orderBy","group_by","groupBy","page","page_idx","includes","index","pow","avg","min","max","range","density","max_is","min_is","values","floor","in","JSON","stringify","old","rowid","$step","Format","each","validate","process","chklist","partition","paths","finish_order","results1","finish","hit","delete","news","update"],"mappings":"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","file":"lib/index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Mem\"] = factory();\n\telse\n\t\troot[\"Mem\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"lodash\");","_ = require 'lodash'\n\nSet = {}\nMap = {}\nName = {}\nQuery = {}\nFinder = {}\n\nOBJ = ->\n  new Object null\n\ncache = (type, { list })->\n  State[type][list] ?=\n    $sort:   OBJ()\n    $memory: OBJ()\n    $format:  OBJ()\n\nState =\n  transaction: (cb)->\n    State.$journal = result = OBJ()\n    cb()\n    State.$journal = OBJ()\n    result\n\n  journal: cache.bind null, '$journal'\n  base:    cache.bind null, '$base'\n  step:     OBJ()\n  $journal: OBJ()\n  $base:    OBJ()\n\n  store: (pack)->\n    for list, { $sort, $memory, $format } of pack\n      { model } = Finder[list]\n      base = State.base { list }\n\n      for key, o of $sort\n        base.$sort[key] = o\n\n      for key, o of $format\n        base.$format[key] = o\n\n      for key, o of $memory\n        model.bless o.item\n        base.$memory[key] = o\n\n      Finder[list].clear_cache()\n\n    true\n\nset_deploy = (key, cb)-> Name[key].deploys.push cb\nset_depend = (key, cb)-> Name[key].depends.push cb\nmerge = (o)->\n  for key, val of o\n    switch\n      when Query[key]?\n        key = Name[key].base\n        Set[key].merge val\n      when Set[key]?\n        Set[key].append val\n\nmodule.exports = { Set, Map, Name, State, Finder, Query, set_deploy, set_depend, merge }\n","_ = require \"lodash\"\n\n\nset_for = (list)->\n  set = new Object null\n  for key in list\n    set[key] = true\n  set\n\nquery_parser = (base, req, cb)->\n  return base unless req\n\n  new Query base, ->\n    @_filters = base._filters.concat()\n    switch req && req.constructor\n      when Object\n        for key, val of req\n          cb @, key, val, _.property key\n\n      when Function, Array, String\n        cb @, null, req, (o)-> o\n      else\n        console.log { req }\n        #throw Error 'unimplemented'\n\n\nmodule.exports = class Query\n  @build: ({ $sort, $memory })->\n    _all_ids = _group = null\n    _filters = []\n    $partition = [\"set\"]\n    new Query { _all_ids, _group, _filters, $sort, $partition }, ->\n      @all = @\n      @$memory = $memory\n\n  constructor: (base, tap)->\n    @_step = 0\n    @_copy base\n    tap.call @\n\n  _copy: ({ @all, @_all_ids, @_group, @_filters, @$sort, @$partition, @$page_by })->\n\n  in: (req)->\n    query_parser @, req, (q, target, req, path)->\n      add = (f)-> q._filters.push f\n      switch req?.constructor ? req\n        when Array\n          set = set_for req\n          add (o)->\n            for key in path o\n              return true if set[key]\n            false\n        when RegExp\n          add (o)->\n            for val in path o\n              return true if req.test val\n            false\n        when null, 0, \"\", Boolean, String, Number\n          add (o)->\n            -1 < path(o)?.indexOf req\n        else\n          console.log { target, req: [req, req?.constructor] }\n          throw Error 'unimplemented'\n\n  partition: (...ary)->\n    new Query @, ->\n      @$partition = ary\n\n  where: (req)->\n    query_parser @, req, (q, target, req, path)->\n      add = (f)-> q._filters.push f\n      switch req?.constructor ? req\n        when Function\n          add req\n        when Array\n          if \"_id\" == target\n            q._all_ids = req\n          else\n            set = set_for req\n            add (o)-> set[ path o ]\n        when RegExp\n          add (o)-> req.test path o\n        when null, 0, \"\", Boolean, String, Number\n          if \"_id\" == target\n            q._all_ids = [req]\n          else\n            add (o)-> req == path o\n        else\n          console.log { target, req: [req, req?.constructor] }\n          throw Error 'unimplemented'\n\n  search: (text)->\n    return @ unless text\n    list =\n      for item in text.split(/\\s+/)\n        item = item.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n        continue unless item.length\n        \"(#{item})\"\n    return @ unless list.length\n    regexp = (new RegExp list.join(\"|\"), \"ig\")\n    @where (o)->\n      s = o.q.search_words\n      (!s) || regexp.test s\n\n  shuffle: ->\n    @sort Math.random\n\n  order: (order)->\n    return @ if _.isEqual order, @$sort['_reduce.list']\n    new Query @, ->\n      @$sort = _.cloneDeep @$sort\n      @$sort['_reduce.list'] = order\n\n  sort: (sort...)->\n    @order { sort }\n  \n  page: (page_by)->\n    new Query @, ->\n      @$page_by = page_by\n\n  form: (ids...)->\n    oo = @find ...ids\n    if oo\n      o = @all.$memory[oo.id].form ?= {}\n      o.__proto__ = oo\n      o\n    else\n      oo\n\n  find: (ids...)->\n    for id in ids when o = @hash[id]\n      return o if o\n    null\n\n  finds: (ids)->\n    for id in ids when o = @hash[id]\n      o\n\n  pluck: -> @list.pluck arguments...\n\n  Object.defineProperties @::,\n    reduce:\n      get: ->\n        @all._finder.calculate @, @all.$memory\n        @_reduce\n\n    list:\n      get: ->\n        @reduce.list\n\n    hash:\n      get: ->\n        @reduce.hash\n\n    memory:\n      get: ->\n        @all.$memory\n\n    ids:\n      get: ->\n        Object.keys @hash\n","module.exports = Mem = require \"./mem.coffee\"\nMem.Rule = require \"./rule.coffee\"\nMem.Base = require \"./base.coffee\"\n","\nmodule.exports =\n  Query:  require \"./query.coffee\"\n  Set:    require \"./set.coffee\"\n  Map:    require \"./map.coffee\"\n  List:   require \"./list.coffee\"\n  Model:  require \"./model.coffee\"\n  Finder: require \"./finder.coffee\"\n","_ = require \"lodash\"\nMem = require \"./mem.coffee\"\n{ Finder, Query, Model, List, Set, Map } = require \"./base.coffee\"\n\nrename = (base)->\n  base = _.snakeCase(base).replace /s$/, \"\"\n  name = Mem.Name[base]\n  return name if name\n\n  id =   \"#{base}_id\"\n  ids =  \"#{base}_ids\"\n  list = \"#{base}s\"\n  deploys = []\n  depends = []\n  Mem.Name[list] = Mem.Name[base] = { id, ids, list, base, deploys, depends }\n\nmodule.exports = class Rule\n  constructor: (base, cb)->\n    @$name = rename base\n    @model = Model\n    @list  = List\n    @set   = Set\n    @map   = Map\n\n    @all = Query.build Mem.State.base(@$name)\n    @all.cache = {}\n    @all._finder = new Finder @$name\n\n    @depend_on base\n\n    @map_property = {}\n\n    { base } = @$name\n    @model_property =\n      id:\n        enumerable: true\n        get: -> @_id\n      \"#{@$name.id}\":\n        enumerable: true\n        get: -> @_id\n\n    @form_property =\n      changes:\n        enumerable: true\n        value: (key)->\n          if _.isEqual @[key], @find[key]\n            null\n          else\n            @$model[key]\n      isChanged:\n        enumerable: true\n        get: ->\n          keys = Object.keys @\n          for key in keys\n            return true unless _.isEqual @[key], @$model[key]\n          return false\n\n    @list_property =\n      first:\n        enumerable: false\n        get: -> @[0]\n      head:\n        enumerable: false\n        get: -> @[0]\n      tail:\n        enumerable: false\n        get: -> @[@length - 1]\n      last:\n        enumerable: false\n        get: -> @[@length - 1]\n\n      uniq:\n        enumerable: false\n        get: ->\n          @constructor.bless _.uniq @\n\n      pluck:\n        enumerable: false\n        value: (keys...)->\n          cb =\n            switch keys.length\n              when 0\n                -> null\n              when 1\n                _.property keys[0]\n              else\n                (o)-> _.at(o, keys...)\n          @constructor.bless @map cb\n\n    @set_property = {}\n\n    @schema cb if cb\n    return\n\n  schema: (cb)->\n    cb.call @\n    if @model == Model\n      class @model extends @model\n    Object.defineProperties @model::, @model_property\n\n    if @list == List\n      class @list extends @list\n    Object.defineProperties @list::, @list_property\n\n    if @set == Set\n      class @set extends @set\n    Object.defineProperties @set::, @set_property\n\n    if @map == Map\n      class @map extends @map\n    Object.defineProperties @map::, @map_property\n\n    @model.$name = @list.$name = @set.$name = @map.$name = @$name\n\n    Mem.Query[@$name.list] = @all\n\n    Mem.Set[@$name.base] = _set = new @set\n    _set.all = @all\n    _set.$name = @$name\n    list = @list.bless [], @all\n\n    Mem.Finder[@$name.list] = finder = @all._finder\n    finder.set = @set\n    finder.map = @map\n    finder.list = @list\n    finder.model = @model\n    finder.$format = Mem.State.base(@$name).$format\n    @\n\n  key_by: (keys)->\n    cb =\n      switch keys?.constructor\n        when undefined\n          -> @_id\n        when Function\n          keys\n        when String, Array\n          _.property keys\n        else\n          throw Error \"unimplemented #{keys}\"\n\n    @model_property.id =\n      enumerable: true\n      get: cb\n\n  deploy: (cb)->\n    Mem.set_deploy @$name.base, cb\n\n  depend_on: (parent)->\n    { _finder } = @all\n    Mem.set_depend parent, ->\n      _finder.clear_cache()\n\n  scope: (cb)->\n    for key, val of cb @all\n      @use_cache key, val\n\n\n  property: (type, o)->\n    Object.assign @[\"#{type}_property\"], o\n\n\n  default_scope: (scope)->\n    @all._copy scope @all\n    base = Mem.State.base(@$name)\n    base.$sort = @all.$sort\n\n  shuffle: ->\n    @default_scope (all)-> all.shuffle()\n\n  order: (sort...)->\n    @default_scope (all)-> all.sort sort...\n\n  \n\n  relation_to_one: (key, target, ik, else_id)->\n    @model_property[key] =\n      enumerable: true\n      get: ->\n        id = _.get @, ik\n        Mem.Query[target].find id, else_id\n\n  relation_to_many: (key, target, cmd, ik, qk)->\n    all = @all\n    @use_cache key, (id)->\n      Mem.Query[target][cmd] \"#{qk}\": id\n\n    @model_property[key] =\n      enumerable: true\n      get: ->\n        all[key](@[ik])\n\n  relation_tree: (key, ik)->\n    all = @all\n    @use_cache key, (_id, n)->\n      if n\n        q = all.where \"#{ik}\": _id\n        all[key] q.ids, n - 1\n      else\n        all.where _id: _id\n\n    @model_property[key] =\n      enumerable: true\n      value: (n)->\n        all[key] [@_id], n\n\n  relation_graph: (key, ik)->\n    all = @all\n    @use_cache key, (_id, n)->\n      q = all.where _id: _id\n      if n\n        _ids = []\n        for a in q.pluck(ik) when a?\n          for k in a when k?\n            _ids.push k\n\n        all[key] _.uniq(_ids), n - 1\n      else\n        q\n\n    @model_property[key] =\n      enumerable: true\n      value: (n)->\n        all[key] [@_id], n\n\n  use_cache: (key, val)->\n    switch val?.constructor\n      when Function\n        @all[key] = (args...)=>\n          @all.cache[\"#{key}:#{JSON.stringify args}\"] ?= val args...\n      else\n        @all[key] = val\n\n  path: (keys...)->\n    for key in keys\n      @belongs_to key\n    @deploy ->\n      subids = @_id.split(\"-\")\n      @idx = subids[keys.length]\n      for key, idx in keys\n        @[\"#{key}_id\"] = subids[0..idx].join '-'\n\n    { all } = @\n    pk = keys[-1..][0] + \"_id\"\n    @model_property.siblings =\n      get: ->\n        q = {}\n        q[pk] = @[pk]\n        all.where q\n\n  belongs_to: (to, option = {})->\n    name = rename to\n    { key = name.id, target = name.list, miss } = option\n    @relation_to_one name.base, target, key, miss\n\n  habtm: (to, option = {})->\n    name = rename to\n    if option.reverse\n      { key = @$name.ids, target = to } = option\n      @relation_to_many name.list, target, \"in\", \"_id\", key\n    else\n      { key = name.ids, target = name.list } = option\n      @relation_to_many name.list, target, \"where\", key, \"_id\"\n\n  has_many: (to, option = {})->\n    name = rename to\n    { key = @$name.id, target = name.list } = option\n    @relation_to_many name.list, target, \"where\", \"_id\", key\n\n  tree: (option = {})->\n    fk = @$name.id\n    @relation_tree \"nodes\", fk\n    @belongs_to @$name.base, option\n\n    Object.defineProperties @all,\n      leaf:\n        get: ->\n          not_leaf = _.uniq @pluck fk\n          @where (o)-> o._id not in not_leaf\n\n  graph: (option = {})->\n    { directed, cost } = option\n    ik = @$name.ids\n    @relation_to_many @$name.list, @$name.list, \"where\", ik, \"_id\"\n    @relation_graph \"path\", ik\n    unless directed\n      true # todo\n","_ = require \"lodash\"\n{ State } = require \"./index.coffee\"\nQuery = require \"./query.coffee\"\n\nf_reset = (list, parent)->\n  @all._finder.reset @all, list, parent\n\nf_merge = (list, parent)->\n  @all._finder.merge @all, list, parent\n\nf_remove = (list)->\n  @all._finder.remove @all, list\n\nf_item = (cb)->\n  (item, parent)->\n    if item?\n      cb.call @, [item], parent\n\nf_clear = ->\n  @all._finder.clear_cach @all\n\n\nmodule.exports = class Set\n  set:           f_reset\n  reset:         f_reset\n\n  merge:         f_merge\n  add:    f_item f_merge\n  append: f_item f_merge\n\n  reject:        f_remove\n  del:    f_item f_remove\n  remove: f_item f_remove\n\n  clear_cache:   f_clear\n  refresh:       f_clear\n  rehash:        f_clear\n","_ = require \"lodash\"\n{ State, Query } = require \"./mem.coffee\"\n\nmatrix =\n  map: (cb)->\n    list = []\n    for a in @ when a\n      for item in a\n        list.push cb item\n    list\n\nmodule.exports = class Map\n  @bless: (o)->\n    o.__proto__ = @::\n    o\n\n  @$deploy: (model, $format, $sort, journal, item, parent)->\n    o = { item, $group: [] }\n\n    model.$deploy item, parent\n    @$deploy_reduce model, item, $format, journal, o\n    @$deploy_sort   model, item, $sort,   journal\n    o\n\n  @$deploy_reduce: (model, item, $format, journal, o)->\n    emit = (target)=> (keys..., cmd)=>\n      path = [\"_reduce\", keys...].join('.')\n      target.push [path, cmd]\n      map   = $format[path] ?= {}\n      @init map,   cmd\n      map_j = journal.$format[path] ?= {}\n      @init map_j, cmd\n    emit_group = emit o.$group\n    emit_group\n      list: true\n    model.map_partition item, emit_group\n    model.map_reduce    item, emit_group\n\n  @$deploy_sort: (model, item, $sort, journal)->\n    emit = (keys..., cmd)->\n      path = [\"_reduce\", keys...].join('.')\n      $sort[path] = cmd\n      journal.$sort[path] = cmd\n    emit \"list\", {}\n    model.order item, emit\n\n  @init: (o, map)->\n    if map.id\n      o.id = map.id\n    if map.list\n      o.list = []\n    if map.count\n      o.count = 0\n    if map.all\n      o.all = 0\n    if map.set\n      o.hash = {}\n\n  @order: (query, path, from, map, list, cb)->\n    o = from\n    if Object == from.constructor\n      if map.belongs_to\n        for id, val of from\n          val.__proto__ = Query[map.belongs_to].find id\n      else\n        for id, val of from\n          val.id = id\n\n    else\n      if map.belongs_to\n        for val in from\n          val.__proto__ = Query[map.belongs_to].find val.id\n\n    if map.sort\n      o = _.orderBy o, map.sort...\n    \n    if map.pluck\n      o = for oo in o when val = _.get oo, map.pluck\n        val\n\n    if key = map.group_by\n      from = o\n      o = _.groupBy o, (oo)-> _.get oo, key\n      for a of o when a\n        cb a\n\n    if map.page && per = query.$page_by\n      from = o\n      o = []\n      o.all = from.length\n      for oo, idx in from\n        unless idx % per\n          o.push c = []\n        c.push oo\n      o.page_idx = (item)->\n        for a, page_idx in @ when a.includes item\n          return page_idx\n        null\n      for a in o when a\n        cb a\n\n    if key = map.index\n      counts = []\n      for ___, oo of o\n        idx = _.get oo, key\n        counts[idx] ?= []\n        counts[idx].push oo\n      o = counts\n      for a in o when a\n        cb a\n\n    cb o\n    o\n\n  @finish: (query, path, o, list)->\n    if o.hash\n      o.set = Object.keys o.hash\n    if o.count && o.pow?\n      o.avg = o.all ** (1 / o.count)\n    if o.count && o.all?\n      o.avg = o.all * (1 / o.count)\n    if o.min? && o.max?\n      o.range = o.max - o.min\n      if o.all\n        o.density = o.all / o.range\n\n  @reduce: (query, path, item, o, map)->\n    if map.count\n      o.count += map.count\n    if map.all\n      o.all += map.all\n    if map.pow\n      o.pow *= map.pow\n\n    if map.list\n      o.list.push item\n\n    if map.set\n      o.hash[map.set] = item\n\n    if map.max\n      unless map.max <= o.max\n        o.max_is = item\n        o.max = map.max\n    if map.min\n      unless o.min <= map.min\n        o.min_is = item\n        o.min = map.min\n","_ = require \"lodash\"\nMem = require \"./mem.coffee\"\nQuery = require \"./query.coffee\"\n\nmodule.exports = class List extends Array\n  @bless: (list, query)->\n    list.__proto__ = @::\n    list.query = query\n    list\n\n  sort: (sort...)->\n    o = _.orderBy @, sort...\n    o.__proto__ = @__proto__\n    o\n\n  group_by: (cb)->\n    o = _.groupBy @, cb\n    for key, oo of o\n      oo.__proto__ = @__proto__\n    o\n\n  page_by: (per)->\n    idx = 0\n    Object.values @group_by (o)->\n      Math.floor(idx++ / per)\n\n  where: (req)-> @query.where req\n  in:    (req)-> @query.in    req\n","_ = require \"lodash\"\n\n\nmodule.exports = class Model\n  @rowid = 0\n\n  @bless: (o)->\n    o.__proto__ = @::\n    o\n\n  @$deploy: (item, parent)->\n    @bless item\n    Object.assign item, parent\n    for deploy in @$name.deploys\n      deploy.call item, @\n    unless item.id\n      throw new Error \"detect bad data: #{JSON.stringify item}\"\n\n  @update: (item, old)->\n  @create: (item)->\n  @delete: (old)->\n\n  @map_partition:  (item, emit)->\n    emit\n      set: item.id\n\n  @map_reduce: (item, emit)->\n    undefined\n\n  @order: (reduce, emit)->\n    undefined\n","_ = require \"lodash\"\n{ State, Query, Format } = require \"./mem.coffee\"\n\n\neach = ({ list, depends }, from, process)->\n\n  f() for f in depends\n  switch from?.constructor\n    when Array\n      for item in from\n        process item\n    when Object\n      for id, item of from\n        item._id = id\n        process item\n  return\n\nvalidate = (item, chklist)->\n  return false unless item and chklist\n  for chk in chklist when ! chk item\n    return false\n  true\n\n$step = 0\n\nmodule.exports = class Finder\n  constructor: (@$name)->\n    State.step[@$name.list] = ++$step\n    State.base(@$name)\n\n  calculate: (query, memory)->\n    return unless query._step < State.step[@$name.list]\n\n    delete query._reduce\n    query._step = ++$step\n\n    cache = _.cloneDeep @$format\n    paths =\n      _reduce:\n        list: []\n        hash: {}\n\n    if query._all_ids\n      @reduce @map, cache, paths, query, memory, query._all_ids\n    else\n      if query == query.all\n        @reduce @map, cache, paths, query, memory, Object.keys memory\n      else\n        for partition in query.$partition\n          @reduce @map, cache, paths, query, memory, _.get query.all, \"reduce.#{partition}\"\n\n    @finish_order @map, cache, paths, query\n    return\n\n  reduce: (map, cache, paths, query, memory, ids)->\n    return unless ids\n    for id in ids when o = memory[id]\n      { item, $group } = o\n      continue unless validate item, query._filters\n      for [path, a] in $group\n        o = paths[path] = cache[path]\n        map.reduce query, path, item, o, a\n\n  finish_order: (map, cache, paths, query)->\n    for path, o of paths\n      map.finish query, path, o, @list\n      _.set query, path, o\n\n    for path, cmd of query.$sort when o = from = _.get(query, path)\n      o = map.order query, path, o, cmd, @list, (target)=>\n        @list.bless target, query\n      o.from = from\n      _.set query, path, o\n\n  clear_cache: (all = null)->\n    State.step[@$name.list] = ++$step\n    if all\n      for id, { item } of all.$memory\n        @map.$deploy_sort @model, item, all\n    return\n\n  remove: (all, from)->\n    { $memory } = all\n    journal = State.journal(@$name)\n    hit = false\n    each @$name, from, (item)=>\n      @model.bless item\n      old = $memory[item.id]\n      if old?\n        @model.delete old.item\n        delete journal.$memory[item.id]\n        delete $memory[item.id]\n        hit = true\n    if hit?\n      @clear_cache()\n\n  reset: (all, from, parent)->\n    { $memory } = all\n    State.journal(@$name).$memory = new Object null\n    State.base(@$name).$memory = all.$memory = news = new Object null\n    @merge all, from, parent\n\n    for key, old of $memory\n      item = news[key]\n      unless item?\n        @model.delete old\n\n  merge: (all, from, parent)->\n    { $memory } = all\n    journal = State.journal(@$name)\n    each @$name, from, (item)=>\n      o = @map.$deploy @model, @$format, all.$sort, journal, item, parent\n      old = $memory[item.id]\n      journal.$memory[item.id] = o\n      $memory[item.id] = o\n      if old?\n        @model.update item, old.item\n      else\n        @model.create item\n        @model.rowid++\n    @clear_cache()\n"],"sourceRoot":""}